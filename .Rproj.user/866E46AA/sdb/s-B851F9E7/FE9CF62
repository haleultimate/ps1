{
    "collab_server" : "",
    "contents" : "symbols <- c(\n  \"XLF\", # Financial sector ETF\n  #\"BRK-B\",    not valid name\n  \"JPM\",\n  \"WFC\",\n  \"BAC\",\n  \"C\",\n  \"USB\",\n  \"GS\",\n  \"AIG\",\n  \"CB\",\n  \"AXP\",\n  \"MET\",\n  \"MS\",\n  \"BLK\",\n  \"PNC\",\n  \"BK\",\n  \"SCHW\",\n  \"CME\",\n  \"COF\",\n  \"MMC\",\n  \"PRU\",\n  \"TRV\",\n  \"SPGI\",\n  \"ICE\",\n  \"BBT\",\n  \"AON\",\n  \"AFL\",\n  \"STT\",\n  \"ALL\",\n  \"DFS\",\n  \"STI\",\n  \"PGR\",\n  \"MTB\",\n  \"HIG\",\n  \"TROW\",\n  \"AMP\",\n  \"FITB\",\n  \"NTRS\",\n  \"PFG\",\n  \"KEY\",\n  \"IVZ\",\n  \"BEN\",\n  \"RF\",\n  \"CINF\",\n  \"L\",\n  \"HBAN\",\n  \"LNC\",\n  \"XL\",\n  \"AJG\",\n  \"UNM\",\n  \"CMA\",\n  \"NDAQ\",\n  \"AMG\",\n  \"ETFC\",\n  \"TMK\",\n  \"ZION\",\n  \"LUK\",\n  \"AIZ\",\n  \"LM\"\n)\nstx_n <- c(2:length(symbols)) #c(2:length(symbols))  c(2:length(symbols))  #c(5:10) #\nstx.symbols <- symbols[stx_n]      #list of stx to trade\nstx <- length(stx_n)\n#load mktdata\nstx_list <- append(1,stx_n)\nstx_list <- symbols[stx_list]      #cmn index + stx to trade\n\nrm.list <- ls(all=TRUE)\nkeep.list <- c(stx_list,\"stx\",\"stx_list\",\"stx.symbols\",\"stx_n\",\"stx_list.old\",\"data.env\")\nisNameinKeep <- rm.list %in% keep.list\nrm.list <- c(rm.list[!isNameinKeep],\"keep.list\",\"isNameinKeep\",\"rm.list\")\nrm(list = rm.list)  #clear environment except for loaded stock data \n\n#setup output to go to logfile\noriginal_wd <- getwd()\n#logdir <- paste(original_wd,\"/logs\",sep=\"\")\n#setwd(logdir)\n#logfile <- file(\"logfile.txt\",\"w\")\n#sink(file=logfile,type=\"output\")\nprint(paste(\"Start time:\",Sys.time()))\n#setwd(original_wd)\n\nrequire(lpSolveAPI)\nrequire(quantmod)\nrequire(dplyr)\nrequire(forecast)\nif (!exists(\"data.env\")) data.env <- new.env()\nvar.env <- new.env()\nrnd.env <- new.env()\ncom.env <- new.env()\n\n#Init data_load vars\nSys.setenv(TZ = \"UTC\")\nadjustment <- TRUE\nstart_date <- \"2004-01-01\" \nend_date <- \"2013-03-31\"\nif (!exists(\"stx_list.old\")) {         #only load if stx_list has changed\n  getSymbols(Symbols = stx_list,\n             env=data.env,\n             src = \"yahoo\", \n             index.class = \"POSIXct\",\n             from = start_date, \n             to = end_date, \n             adjust = adjustment)\n  stx_list.old <- stx_list\n} else if (!identical(stx_list,stx_list.old)) {\n  isNameinStxold <- stx_list %in% stx_list.old\n  stx_list.new <- stx_list[!isNameinStxold]\n  getSymbols(Symbols = stx_list.new, \n             env=data.env,\n             src = \"yahoo\", \n             index.class = \"POSIXct\",\n             from = start_date, \n             to = end_date, \n             adjust = adjustment)\n  rm(stx_list.new,isNameinStxold)\n  stx_list.old <- stx_list\n}\n\n#create cmn lookup (stock contains etf used as cmn, cmn contains the word 'cmn')\ncmn_lookup <- rep('XLF',stx+1)\nnames(cmn_lookup) <- stx_list\ncmn_lookup['XLF'] <- 'cmn'\ncmns <- 1\n\nverbose <- FALSE\ncom.env$model_loops <- 20\ncom.env$add_vars <- 20\n#run_type <- \"add_vars\"\n#insample.r2.threshold <- 0.02\npredict.ret <- \"C2Clf1p\"    #should be set up as first model_var in v.com (define_vars.R)\ncom.env$reg_start_date <- \"200407\"\ncom.env$reg_end_date <- \"20111231\"\ncom.env$OOS_start_date <- \"20120101\"\ncom.env$OOS_end_date <- \"20121231\"\ncom.env$reg_date_range <- paste(com.env$reg_start_date,\"/\",com.env$reg_end_date,sep=\"\")\ncom.env$OOS_date_range <- paste(com.env$OOS_start_date,\"/\",com.env$OOS_end_date,sep=\"\")\ncom.env$sim_date_index <- index(data.env$XLF[com.env$OOS_date_range])\n\ncorr.threshold <- 0.6\n#v.com <- NULL\n#load(file=\"cores50.Rdata\")\n#if (verbose & exists(\"store.data\")) print(store.data[length(store.data)])\n\n#remove problematic stx\nstatic.stx.symbols <- stx.symbols\nfor (i in 1:stx) {\n  ticker <- static.stx.symbols[i]\n  if (make.names(ticker) != ticker) {\n    if (verbose) print(paste(\"remove\",ticker,\"from list, not valid name\",make.names(ticker)))\n    stx.symbols <- stx.symbols[-which(stx.symbols == ticker)] #remove from stx list\n    stx_list <- stx_list[-which(stx_list == ticker)]\n  }\n  cmn <- cmn_lookup[ticker]\n  cmd_string <- paste(\"corr.data <- cbind(data.env$\",cmn,\"[,'\",cmn,\".Adjusted'],data.env$\",ticker,\"[,'\",ticker,\".Adjusted'])\",sep=\"\")\n  #if (verbose) print(cmd_string)\n  eval(parse(text=cmd_string))\n  corr.val <- cor(corr.data[com.env$reg_date_range],use=\"complete.obs\")[1,2]\n  cmd_string <- paste(\"not_enough_history <- nrow(data.env$\",ticker,\") < 320\",sep=\"\")\n  eval(parse(text=cmd_string))\n  if ( (not_enough_history) | (corr.val < corr.threshold) ) {\n    #if (verbose) print(paste(\"remove\",ticker,\"from stx list, not correlated with cmn\",corr.val))\n    stx.symbols <- stx.symbols[-which(stx.symbols == ticker)] #remove from stx list\n    stx_list <- stx_list[-which(stx_list == ticker)]\n  } #else print(corr.val)\n}\nrm(static.stx.symbols,corr.val,corr.data,corr.threshold)\n\nstx <- length(stx.symbols)\nport_size <- init_equity <- 10000*stx\n\n\n",
    "created" : 1482432350441.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3639995578",
    "id" : "FE9CF62",
    "lastKnownWriteTime" : 1482523760,
    "last_content_update" : 1482523760166,
    "path" : "~/XLF/ps1/init_session.R",
    "project_path" : "init_session.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}